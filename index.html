<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simulador de Recebimentos — SouFacil</title>
  <style>
    /* Estética "Apple-like" simples: azul, branco, cantos arredondados, sombras suaves */
    :root{
      --bg:#f6fbff;
      --card:#ffffff;
      --primary:#0a66ff; /* azul */
      --muted:#6b7a90;
      --glass: rgba(255,255,255,0.6);
      --shadow: 0 10px 30px rgba(10,20,50,0.08);
      --radius:18px;
      --accent: linear-gradient(135deg,#0a66ff, #2aa3ff);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    html,body{height:100%;margin:0;background:var(--bg);color:#123;}
    .wrap{max-width:1000px;margin:32px auto;padding:28px;}

    header{display:flex;align-items:center;gap:18px;margin-bottom:20px}
    .logo{width:72px;height:72px;background:var(--accent);border-radius:16px;box-shadow:var(--shadow);display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:20px}
    h1{margin:0;font-size:20px}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    .grid{display:grid;grid-template-columns:360px 1fr;gap:20px}

    .card{background:var(--card);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow);}
    .control{display:flex;flex-direction:column;gap:10px}
    label{font-size:12px;color:var(--muted)}
    input[type="number"], select{width:100%;padding:10px;border-radius:10px;border:1px solid #e6eefc;background:linear-gradient(180deg,#fff,#fbfeff);font-size:14px}
    .row{display:flex;gap:10px}
    .row > *{flex:1}
    .small{font-size:12px;color:var(--muted)}

    .btn{background:var(--primary);color:white;padding:10px 14px;border-radius:12px;border:none;cursor:pointer;font-weight:600;box-shadow:0 6px 18px rgba(10,100,255,0.18)}
    .btn.secondary{background:transparent;color:var(--primary);border:1px solid rgba(10,102,255,0.12)}

    .preview{display:flex;flex-direction:column;gap:12px}
    table{width:100%;border-collapse:collapse;font-size:14px}
    th,td{padding:10px;text-align:left;border-bottom:1px solid #f1f7ff}
    th{font-weight:700;color:var(--muted);font-size:12px}

    .kpi{display:flex;gap:12px;align-items:center}
    .kpi .item{background:linear-gradient(180deg,#fff,#fbfeff);padding:12px;border-radius:12px;box-shadow:0 6px 15px rgba(10,20,50,0.04);min-width:140px}
    .muted{color:var(--muted);font-size:12px}

    /* estilo responsivo */
    @media (max-width:880px){
      .grid{grid-template-columns:1fr;}
      .logo{width:56px;height:56px}
    }

    /* pequenas decorações */
    .footer{margin-top:14px;color:var(--muted);font-size:12px}
    .chip{display:inline-block;background:var(--glass);padding:6px 10px;border-radius:999px;border:1px solid rgba(10,100,255,0.06);font-size:12px}

    .table-wrap{overflow:auto;border-radius:12px}
    .highlight{color:var(--primary);font-weight:700}

    canvas{width:100%;height:140px;border-radius:12px;background:linear-gradient(180deg,#ffffff00,#ffffff00)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">SF</div>
      <div>
        <h1>Simulador de Recebimentos — SouFacil</h1>
        <p class="lead">Mostre ao lojista como funcionam os recebimentos em 4x e os descontos. Ajuste os parâmetros e copie o resultado.</p>
      </div>
    </header>

    <div class="grid">
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <div>
            <div class="muted">Configurações</div>
            <strong>Parâmetros da simulação</strong>
          </div>
          <div class="chip">Tema Azul • Clean</div>
        </div>

        <div class="control">
          <div>
            <label>Vendas por mês (quantidade de vendas de R$):</label>
            <input id="salesCount" type="number" min="1" value="10" />
            <div class="small">Ex.: 10 vendas de R$300 por mês → total R$3.000</div>
          </div>

          <div class="row">
            <div>
              <label>Valor por venda (R$)</label>
              <input id="saleValue" type="number" min="1" step="0.01" value="300" />
            </div>
            <div>
              <label>Parcelas por venda</label>
              <select id="installments">
                <option value="2">2x</option>
                <option value="3">3x</option>
                <option value="4" selected>4x</option>
                <option value="6">6x</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div>
              <label>Taxa por parcela (R$)</label>
              <input id="feePerParcel" type="number" min="0" step="0.01" value="4.90" />
            </div>
            <div>
              <label>Desconto mensal (R$)</label>
              <input id="monthlyFee" type="number" min="0" step="0.01" value="150" />
            </div>
          </div>

          <div style="display:flex;gap:8px;align-items:center;justify-content:space-between">
            <div style="display:flex;gap:8px;align-items:center">
              <input id="skipFirstDiscount" type="checkbox" checked />
              <label class="small">Não cobrar desconto no mês da 1ª venda (Outubro)</label>
            </div>
            <div>
              <button class="btn" id="run">Simular</button>
            </div>
          </div>

          <div class="footer">Meses fixos: Outubro → Fevereiro (vendas em Out, Nov, Dez, Jan; Fevereiro só recebe)</div>
        </div>
      </div>

      <div class="preview card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="muted">Resultado</div>
            <strong>Tabela de Recebimentos (Outubro → Fevereiro)</strong>
          </div>
          <div style="display:flex;gap:10px;align-items:center">
            <button class="btn secondary" id="copyBtn">Copiar tabela</button>
          </div>
        </div>

        <div style="margin-top:12px" class="kpi">
          <div class="item">
            <div class="muted">Receita Líquida Total</div>
            <div id="totalNet" style="font-size:18px;margin-top:6px">R$ 0,00</div>
          </div>
          <div class="item">
            <div class="muted">Receita Bruta Total</div>
            <div id="totalGross" style="font-size:18px;margin-top:6px">R$ 0,00</div>
          </div>
          <div class="item">
            <div class="muted">Taxas Totais</div>
            <div id="totalFees" style="font-size:18px;margin-top:6px">R$ 0,00</div>
          </div>
        </div>

        <div style="margin-top:12px" class="table-wrap card">
          <table id="table">
            <thead>
              <tr><th>Mês</th><th>Parc. recebidas (grupos)</th><th>Valor por parcela (R$)</th><th>Receita antes do desconto (R$)</th><th>Desconto mensal (R$)</th><th>Receita líquida (R$)</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <canvas id="chart"></canvas>

        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
          <div class="muted">Explique rapidamente: cada "grupo" = todas as vendas do mês (ex.: 10 vendas de R$300).</div>
          <div><button class="btn" id="downloadCSV">Baixar CSV</button></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Funções utilitárias
    const months = ['Outubro','Novembro','Dezembro','Janeiro','Fevereiro'];

    function fmt(n){
      return n.toLocaleString('pt-BR', {minimumFractionDigits:2, maximumFractionDigits:2});
    }

    function simulate(){
      const salesCount = Number(document.getElementById('salesCount').value);
      const saleValue = Number(document.getElementById('saleValue').value);
      const installments = Number(document.getElementById('installments').value);
      const feePerParcel = Number(document.getElementById('feePerParcel').value);
      const monthlyFee = Number(document.getElementById('monthlyFee').value);
      const skipFirstDiscount = document.getElementById('skipFirstDiscount').checked;

      // Cada mês de venda: Out, Nov, Dec, Jan (index 0..3)
      const saleMonths = [0,1,2,3];

      // valor por parcela de cada venda
      const parcelPerSale = saleValue / installments;
      // group parcel (todos os salesCount juntos)
      const groupParcelGross = parcelPerSale * salesCount;
      // taxa por parcela do grupo (fee per parcel * salesCount)
      const feePerGroupParcel = feePerParcel * salesCount;
      // valor líquido por parcela de grupo
      const groupParcelNet = groupParcelGross - feePerGroupParcel;

      const rows = [];
      let totals = {gross:0, fees:0, net:0};

      for(let i=0;i<months.length;i++){
        let groupsThisMonth = 0; // quantos grupos (meses de venda) pagam parcela neste mês
        // cada venda gera parcelas que começam no mês seguinte: saleMonth+1 ... saleMonth+installments
        for(const s of saleMonths){
          if(i >= s+1 && i <= s+installments){ groupsThisMonth += 1; }
        }
        const gross = groupsThisMonth * groupParcelNet; // aqui já subtraímos a taxa por parcela ao construir groupParcelNet
        const fees = groupsThisMonth * feePerGroupParcel; // para reporte
        // desconto mensal aplica exceto no primeiro mês se skipFirstDiscount
        const applyDiscount = !(skipFirstDiscount && i===0) && (i>=1); // desconto não em Outubro se marcado
        const discount = applyDiscount ? monthlyFee : 0;
        const net = gross - discount;

        totals.gross += gross;
        totals.fees += fees;
        totals.net += net;

        rows.push({
          month: months[i],
          groups: groupsThisMonth,
          perParcel: groupParcelNet,
          gross: gross,
          discount: discount,
          net: net
        });
      }

      renderTable(rows, totals);
      renderChart(rows);
      return {rows, totals};
    }

    function renderTable(rows, totals){
      const tbody = document.querySelector('#table tbody');
      tbody.innerHTML = '';
      for(const r of rows){
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${r.month}</td><td>${r.groups}</td><td>R$ ${fmt(r.perParcel)}</td><td>R$ ${fmt(r.gross)}</td><td>R$ ${fmt(r.discount)}</td><td><strong>R$ ${fmt(r.net)}</strong></td>`;
        tbody.appendChild(tr);
      }
      document.getElementById('totalGross').innerText = 'R$ ' + fmt(totals.gross);
      document.getElementById('totalFees').innerText = 'R$ ' + fmt(totals.fees);
      document.getElementById('totalNet').innerText = 'R$ ' + fmt(totals.net);
    }

    // gráfico simples: barras de receita líquida
    function renderChart(rows){
      const canvas = document.getElementById('chart');
      canvas.width = canvas.clientWidth * devicePixelRatio;
      canvas.height = canvas.clientHeight * devicePixelRatio;
      const ctx = canvas.getContext('2d');
      ctx.scale(devicePixelRatio, devicePixelRatio);
      // limpar
      ctx.clearRect(0,0,canvas.clientWidth,canvas.clientHeight);
      const w = canvas.clientWidth;
      const h = canvas.clientHeight;
      const padding = 28;

      // eixo y
      const values = rows.map(r => r.net);
      const max = Math.max(...values,1);

      // desenhar barras
      const barW = (w - padding*2) / rows.length - 12;
      rows.forEach((r,i)=>{
        const x = padding + i * (barW + 12);
        const barH = (r.net / max) * (h - padding*2);
        // sombra
        ctx.fillStyle = 'rgba(10,102,255,0.12)';
        roundRect(ctx, x-2, h - padding - barH - 6, barW+4, barH+6, 8, true, false);
        // gradiente
        const g = ctx.createLinearGradient(0, h - padding - barH, 0, h - padding);
        g.addColorStop(0, '#2aa3ff');
        g.addColorStop(1, '#0a66ff');
        ctx.fillStyle = g;
        roundRect(ctx, x, h - padding - barH, barW, barH, 8, true, false);
        // label
        ctx.fillStyle = '#0b2a4a';
        ctx.font = '12px -apple-system, Roboto, Arial';
        ctx.fillText(rows[i].month, x, h - padding + 16);
        ctx.fillText('R$ ' + fmt(rows[i].net), x, h - padding - barH - 12);
      });
    }

    // helper para retângulos arredondados
    function roundRect(ctx, x, y, width, height, radius, fill, stroke){
      if (typeof radius === 'undefined') radius = 5;
      if (typeof radius === 'number') radius = {tl: radius, tr: radius, br: radius, bl: radius};
      ctx.beginPath();
      ctx.moveTo(x + radius.tl, y);
      ctx.lineTo(x + width - radius.tr, y);
      ctx.quadraticCurveTo(x + width, y, x + width, y + radius.tr);
      ctx.lineTo(x + width, y + height - radius.br);
      ctx.quadraticCurveTo(x + width, y + height, x + width - radius.br, y + height);
      ctx.lineTo(x + radius.bl, y + height);
      ctx.quadraticCurveTo(x, y + height, x, y + height - radius.bl);
      ctx.lineTo(x, y + radius.tl);
      ctx.quadraticCurveTo(x, y, x + radius.tl, y);
      ctx.closePath();
      if (fill) ctx.fill();
      if (stroke) ctx.stroke();
    }

    // Ações UI
    document.getElementById('run').addEventListener('click', ()=>simulate());
    document.getElementById('copyBtn').addEventListener('click', ()=>{
      const {rows} = simulate();
      // montar texto simples
      let text = 'Mês\tParc.\tValor por parcela\tReceita antes\tDesconto\tReceita líquida\n';
      for(const r of rows){
        text += `${r.month}\t${r.groups}\tR$ ${fmt(r.perParcel)}\tR$ ${fmt(r.gross)}\tR$ ${fmt(r.discount)}\tR$ ${fmt(r.net)}\n`;
      }
      navigator.clipboard.writeText(text).then(()=>{
        alert('Tabela copiada para a área de transferência. Cole em um e-mail ou Excel.');
      });
    });

    document.getElementById('downloadCSV').addEventListener('click', ()=>{
      const {rows} = simulate();
      const header = ['Mes','ParcGroups','PerParcel','Gross','Discount','Net'];
      const lines = [header.join(',')];
      for(const r of rows){ lines.push([r.month,r.groups,r.perParcel,r.gross,r.discount,r.net].join(',')); }
      const blob = new Blob([lines.join('\n')], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'simulacao_recebimentos.csv'; a.click(); URL.revokeObjectURL(url);
    });

    // rodar inicialmente
    simulate();
  </script>
</body>
</html>
